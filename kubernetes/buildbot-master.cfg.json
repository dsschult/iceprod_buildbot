{
    "apiVersion": "v1",
    "data": {
        "master.cfg": "from __future__ import print_function\n\nimport os\nimport json\nimport importlib\n\nimport multiprocessing\n\nfrom buildbot.plugins import *\n\nfrom master_cfg_d import Config\n\n# This is the dictionary that the buildmaster pays attention to. We also use\n# a shorter alias to save typing.\nc = BuildmasterConfig = {}\n\n# 'protocols' contains information about protocols which master will use for\n# communicating with workers. You must define at least 'port' option that workers\n# could connect to your master with this protocol.\n# 'port' must match the value configured into the workers (with their\n# --master option)\nc['protocols'] = {'pb': {'port': 9989}}\n\n####### Locks\n\nlocks = {\n}\n\n####### Plugins\n\nplugins = {}\nfor mod in os.listdir('master_cfg_d'):\n    if mod.startswith('_'):\n        continue\n    mod = mod.rsplit('.',1)[0]\n    x = importlib.import_module('master_cfg_d.'+mod,package='master_cfg_d')\n    print(mod,dir(x))\n    plugins[mod] = x\n\n\ntop = Config()\ntop.locks.update({\n    'cpu': util.MasterLock('cpu', maxCount=multiprocessing.cpu_count()-2),\n    'gpu': util.MasterLock('gpu', maxCount=1),\n})\nfor p in plugins.values():\n    if p.config:\n        top.register_dependency(p.config)\ntop()\nfor x in ('workers','change_source','builders','schedulers'):\n    c[x] = top[x].values()\n\nfrom pprint import pprint\npprint(c)\n\ndef codebaseGenerator(chdict):\n    for key in top.codebases:\n        if top.codebases[key] == chdict['repository']:\n            return key\n    raise Exception('no codebase matching '+chdict['repository'])\n\nc['codebaseGenerator'] = codebaseGenerator\n\n# add a force scheduler for all the builders\nc['schedulers'].append(schedulers.ForceScheduler(\n                       name=\"force\",\n                       builderNames=[str(b.name) for b in c['builders']]))\n\n####### BUILDBOT SERVICES\n\n# 'services' is a list of BuildbotService items like reporter targets. The\n# status of each build will be pushed to these targets. buildbot/reporters/*.py\n# has a variety to choose from, like IRC bots.\n\nc['services'] = []\n\n####### PROJECT IDENTITY\n\n# the 'title' string will appear at the top of this buildbot installation's\n# home pages (linked to the 'titleURL').\n\nc['title'] = \"IceProd Buildbot\"\nc['titleURL'] = \"https://github.com/WIPACrepo/iceprod\"\n\n# the 'buildbotURL' string should point to the location where the buildbot's\n# internal web server is visible. This typically uses the port number set in\n# the 'www' entry below, but with an externally-visible host name which the\n# buildbot cannot figure out without some help.\n\nif 'BUILDBOT_MASTER_URL' in os.environ:\n    c['buildbotURL'] = os.environ['BUILDBOT_MASTER_URL']\nelse:\n    import socket\n    try:\n        host = socket.getfqdn()\n    except Exception:\n        host = 'localhost'\n    c['buildbotURL'] = 'http://'+host+':8010/'\n\n# minimalistic config to activate new web UI\nc['www'] = dict(port=8010,\n                plugins=dict(waterfall_view={}, console_view={}))\n\n####### DB URL\n\nc['db'] = {\n    # This specifies what database buildbot uses to store its state.  You can leave\n    # this at its default for all but the largest installations.\n    'db_url' : \"sqlite:///state.sqlite\",\n}\n"
    },
    "kind": "ConfigMap",
    "metadata": {
        "name": "buildbot-master.cfg"
    }
}